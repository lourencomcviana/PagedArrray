{"version":3,"sources":["../src/PagedArray.ts"],"names":[],"mappings":"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","file":"PagedArray.js","sourcesContent":["import Promise =require( 'bluebird');\r\nlet x= require('../package-lock.json');\r\n\r\ninterface ItemRange{\r\n  readonly min:number,\r\n  readonly max:number\r\n}\r\ninterface PageInfo{\r\n  readonly parameters:Array<any> ;\r\n  readonly pageSize:number;\r\n  readonly pageCurrent:number;\r\n  readonly pageTotal:number;\r\n  readonly pageItemRange:ItemRange;\r\n  readonly pageStart:number;\r\n  readonly pageEnd:number;\r\n}\r\n\r\n\r\ninterface RunFunction{\r\n    (parameter: any, info?:PageInfo):string |number | object | Promise<any>;\r\n}\r\n\r\n\r\ninterface Options{\r\n    [index: string]: any;\r\n    clientPaging?:boolean,\r\n    size?:number;\r\n    run:RunFunction;\r\n}\r\n\r\n\r\ninterface Config extends Options{\r\n   current:number;\r\n}\r\n\r\nfunction instanceOfRunFunction(object: any): object is RunFunction{\r\n    return true;\r\n}\r\n\r\nexport default class PagedArray<T> extends Array implements PageInfo {\r\n\r\n  private config :Config;\r\n  private parameterList :Array<any> ;\r\n  private parameterLength:number;\r\n\r\n  constructor(parameter :Array<any>|number ,options:Options|RunFunction) {\r\n    super();\r\n    this.config=<Config>PagedArray.ProcessOptions(options);\r\n\r\n    this.config.current=0;\r\n    if(typeof parameter=='number'){\r\n      this.parameterLength=<number>parameter; \r\n    }else{\r\n      this.parameterList=<Array<any>>parameter;\r\n    }\r\n    \r\n\r\n  }\r\n  \r\n  public info():PageInfo{\r\n    return {\r\n      parameters:this.parameters,\r\n      pageSize:this.pageSize,\r\n      pageCurrent:this.pageCurrent,\r\n      pageTotal:this.pageTotal,\r\n      pageItemRange:this.pageItemRange,\r\n      pageStart:this.pageStart,\r\n      pageEnd:this.pageEnd\r\n    }\r\n  }\r\n\r\n  static ProcessOptions(options:Options|RunFunction) :Options{\r\n    let model:Options={\r\n      size:100,\r\n      clientPaging:false,\r\n      run:undefined\r\n    };\r\n    \r\n    if(typeof options=='function'){\r\n      model.run=options;\r\n    } else if(typeof options=='object'){\r\n      options=<Options>options;\r\n\r\n      for(let id in model){\r\n        if(!options[id]) options[id]=model[id];\r\n      }\r\n\r\n      \r\n      return options;\r\n    }\r\n    return model;\r\n  }\r\n\r\n  get parameters() {\r\n      return this.parameterList;\r\n  }\r\n\r\n  get totalItens():number {\r\n    return this.parameterLength?this.parameterLength: this.parameterList.length;\r\n}\r\n\r\n  get pageSize() {\r\n      return this.config.size;\r\n  }\r\n\r\n  get pageCurrent() {\r\n      return this.config.current;\r\n  }\r\n\r\n  get pageTotal() {\r\n    return Math.ceil(this.totalItens/this.pageSize);\r\n  }\r\n  \r\n  get pageItemRange() {\r\n    let itemSize=this.pageSize*this.pageCurrent\r\n      return{\r\n        min:itemSize,\r\n        max:itemSize+this.pageSize\r\n      };\r\n  }\r\n\r\n  get pageStart() {\r\n    return this.pageSize*this.pageCurrent;\r\n\r\n  }\r\n\r\n  get pageEnd() {\r\n    let end=this.pageStart+this.pageSize;\r\n    let paramLength= this.parameterLength?this.parameterLength:this.parameters.length;\r\n    return end>paramLength?paramLength:end;\r\n  }\r\n\r\n  hasNext(){\r\n    return (this.pageCurrent<this.pageTotal-1)  \r\n  }\r\n\r\n  hasPrevious(){\r\n    return (this.pageCurrent>0)\r\n  }\r\n  \r\n  next(){\r\n    if(this.hasNext()){\r\n      this.config.current++;\r\n      this.load();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  previous(){\r\n    if(this.hasPrevious()){\r\n      this.config.current--;\r\n      this.load();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  goTo(pageNumber:number){\r\n    if(pageNumber>0 && pageNumber<this.pageTotal-1 ){\r\n      this.config.current=pageNumber;\r\n      this.load();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  load(){\r\n    this.length = 0;\r\n   \r\n\r\n    //convert requests to match paging\r\n    if(this.config.clientPaging){\r\n      let result;\r\n      if(this.parameterLength){\r\n        result=this.config.run(this.pageCurrent,this.info())\r\n      }else{\r\n        result=this.config.run(this.parameterList[this.pageCurrent],this.info())\r\n      }\r\n      let mainPromise=Promise.resolve(result);\r\n      for(let id=0;id<this.config.size;id++){\r\n        this.push(genPromise(id,mainPromise));\r\n       \r\n      }\r\n\r\n      function genPromise(id:number,promise:Promise<any>){\r\n        \r\n        return new Promise(function(accept,reject){\r\n          promise\r\n            .then(function(data){\r\n              try{\r\n                accept(data[id]);\r\n              }catch(err){\r\n                reject(err);\r\n              }\r\n            }).catch(function(err){\r\n              reject(err);\r\n            })\r\n        });\r\n      }\r\n    }else{\r\n      for(let idItem=this.pageStart;idItem<this.pageEnd;idItem++){\r\n        let result:string |number | object | Promise<any>;\r\n\r\n        try{\r\n          if(this.parameterLength){\r\n            result=this.config.run(idItem,this.info())\r\n          }else{\r\n            result = this.config.run(this.parameterList[idItem],this.info());\r\n          }\r\n         \r\n        }catch(e){\r\n          result = e;\r\n        }\r\n\r\n        this.push(result);\r\n      }\r\n    }\r\n  }\r\n\r\n  forEach(callbackfn:(value: T, index: number, array: T[],info?:PageInfo) => void,thisArg?:any): Promise<any>{\r\n    \r\n    function recursivePromise(arr:PagedArray<T>): Promise<any>{\r\n      //walk from page to page\r\n\r\n      let x=<Array<any>> arr;\r\n      return Promise.all(arr)\r\n      .then(function(data){\r\n        function callBackInterceptor(\r\n          value: T, index: number, array: T[]\r\n          //callbackfn:(value: T, index: number, array: T[],info?:PageInfo) => void){\r\n        ){\r\n          callbackfn(value,index,array,arr.info());\r\n        }\r\n        //data is not a paged-array, it is a normal array\r\n        \r\n        data.forEach(callBackInterceptor,thisArg);\r\n        if(arr.next()){\r\n          return recursivePromise(arr);\r\n        }\r\n        return data;\r\n      });\r\n    }\r\n    this.config.current=0;\r\n\r\n    this.load();\r\n    return recursivePromise(this);\r\n  };\r\n}"]}